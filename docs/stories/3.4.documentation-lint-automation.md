# Story 3.4: Documentation Lint Automation

## Status
Done

## Story
**As a** ingestion QA steward,
**I want** an automated documentation lint guard that validates our architecture runbooks after retrieval updates,
**so that** operators always rely on minimal-path documentation that matches the shipped scripts and retriever workflow.

## Acceptance Criteria
1. Introduce a project-managed documentation lint command (CLI or script under `scripts/`) that scans at least `docs/architecture/overview.md` and `docs/architecture/source-tree.md` to ensure required references to the minimal-path workflow and `QdrantNeo4jRetriever` remain present, failing with a non-zero exit code when discrepancies are detected. [Source: docs/qa/assessments/3.3-nfr-20251002.md#recommendations] [Source: docs/architecture/overview.md#built-in-tool-playbook] [Source: docs/architecture/source-tree.md#source-tree-blueprint]
2. Wire the documentation lint command into local automation and CI (e.g., invoked from an existing pytest/Make target or GitHub workflow) so merges fail when documentation drift is detected, reusing the structured logging and exit-code expectations from coding standards. [Source: docs/qa/assessments/3.3-nfr-20251002.md#recommendations] [Source: docs/architecture/coding-standards.md#testing-expectations]
3. Update the architecture runbook (or adjacent shard) to document how to run the documentation lint guard alongside the minimal-path workflow so operators treat it as part of the built-in tool playbook. [Source: docs/architecture/overview.md#built-in-tool-playbook] [Source: docs/bmad/focused-epics/ingestion-quality/epic.md#definition-of-done]
4. Provide repeatable automated tests (unit or integration) that cover success, failure, and remediation messaging for the documentation lint logic, adhering to the repository’s testing structure. [Source: docs/architecture/coding-standards.md#testing-expectations] [Source: docs/architecture/source-tree.md#source-tree-blueprint]

## Tasks / Subtasks
- [x] Implement documentation lint script or CLI under `scripts/` that inspects required architecture markdown files and exits non-zero on drift (AC: 1). [Source: docs/architecture/source-tree.md#source-tree-blueprint]
  - [x] Encode checks for minimal-path script references and `QdrantNeo4jRetriever` mentions aligned with the latest retrieval workflow (AC: 1). [Source: docs/architecture/overview.md#minimal-path-workflow]
- [x] Add automated tests exercising the lint guard’s pass/fail states and remediation hints within `tests/` mirroring the existing layout (AC: 4). [Source: docs/architecture/coding-standards.md#testing-expectations] [Source: docs/architecture/source-tree.md#source-tree-blueprint]
- [x] Integrate the lint command into local/CI automation (pytest target, Make task, or workflow job) ensuring failures block merges (AC: 2). [Source: docs/architecture/coding-standards.md#testing-expectations]
- [x] Document the new lint workflow in the architecture overview (or linked shard) so operators run it with the minimal-path sequence (AC: 3). [Source: docs/architecture/overview.md#built-in-tool-playbook] [Source: docs/bmad/focused-epics/ingestion-quality/epic.md#definition-of-done]

## Dev Notes
### Previous Story Insights
- Story 3.3’s QA gate and PO validation flagged documentation lint automation as the remaining follow-up to keep the retriever documentation accurate. [Source: docs/stories/3.3.qdrant-native-retriever.md#qa-results]

### Data Models
- No specific guidance found in architecture docs.

### API Specifications
- No specific guidance found in architecture docs.

### Component Specifications
- No specific guidance found in architecture docs.

### File Locations
- CLI utilities and helper scripts live under `scripts/`, while tests mirror the `src` layout beneath `tests/`. [Source: docs/architecture/source-tree.md#source-tree-blueprint]

### Testing Requirements
- Tests must run through `pytest`, cover unit/integration scenarios, and mock external services as needed. [Source: docs/architecture/coding-standards.md#testing-expectations]

### Technical Constraints
- Tooling runs on Python 3.12 with the documented package set; documentation updates must align with the minimal-path workflows described in the architecture overview. [Source: docs/architecture/tech-stack.md#technology-stack] [Source: docs/architecture/overview.md#built-in-tool-playbook]

## Testing
- `PYTHONPATH=src pytest tests/unit/scripts/test_check_docs.py`
- `PYTHONPATH=src python3 -m scripts.check_docs --strict`

## Change Log

| Date       | Version | Description                                       | Author |
|------------|---------|---------------------------------------------------|--------|
| 2025-10-02 | 0.1     | Draft story capturing documentation lint guard scope | Bob |
| 2025-10-02 | 1.0     | Implemented documentation lint command, automation, and tests | James |

## Dev Agent Record
### Agent Model Used
- Codex (GPT-5)

### Debug Log References
- `PYTHONPATH=src pytest tests/unit/scripts/test_check_docs.py`
- `PYTHONPATH=src pytest tests/integration/cli/test_check_docs_cli.py`
- `ruff check scripts/check_docs.py tests/unit/scripts/test_check_docs.py tests/integration/cli/test_check_docs_cli.py`
- `PYTHONPATH=src python -m scripts.check_docs --json-output artifacts/docs/check_docs_local.json`

### Completion Notes List
- Added `scripts/check_docs.py` with structlog-based reporting, JSON artifact output, and required token checks for minimal-path commands and `QdrantNeo4jRetriever` references.
- Created unit and integration tests covering pass/fail paths, missing documentation files, and CLI execution; integrated lint guard into minimal-path smoke test.
- Updated architecture documentation (overview and source-tree shards) to document the lint workflow and ensure references remain discoverable.

### File List
- scripts/check_docs.py
- scripts/__init__.py
- tests/unit/scripts/test_check_docs.py
- tests/integration/cli/test_check_docs_cli.py
- tests/integration/local_stack/test_minimal_path_smoke.py
- docs/architecture/overview.md
- docs/architecture/source-tree.md

## QA Results
Gate: PASS → qa.qaLocation/gates/3.4.documentation-lint-automation.yml
- **Risk Profile:** docs/qa/assessments/3.4-risk-20251002.md (TECH-001 mitigation in place; monitor lint rule drift and CI noise.)
- **Test Design:** docs/qa/assessments/3.4-test-design-20251002.md (7 scenarios spanning unit, integration, and smoke coverage for pass/fail/remediation paths.)
- **Traceability:** docs/qa/assessments/3.4-trace-20251002.md (Acceptance criteria fully traced with automation evidence.)
- **NFR Assessment:** docs/qa/assessments/3.4-nfr-20251002.md (Security, performance, reliability, and maintainability all PASS.)
- **QA Review:** docs/qa/assessments/3.4-review-20251002.md (PASS with monitor on legacy `uid` warning backlog.)
- **QA Gate:** docs/qa/gates/3.4-documentation-lint-automation.yml (PASS; documentation lint guard exercised via live stack run.)
- **PO Validation:** docs/qa/assessments/3.4-po-validation-20251002.md (GO; story scope aligned with epic Definition of Done.)
