# Story 1.1: Workspace Bootstrap Script

## Status
Review

## Story
**As a** GraphRAG operator,
**I want** an automated script that prepares the Python workspace with required dependencies,
**so that** I can reliably bootstrap the environment before running ingestion and retrieval workflows.

## Acceptance Criteria
1. Executing `scripts/bootstrap.sh` from the repository root verifies Python 3.12 availability, creates an isolated virtual environment (default `.venv`), and fails with guidance when the interpreter is missing or the version is incompatible. [Source: prd.md#epic-1--environment--workspace] [Source: architecture/tech-stack.md#technology-stack]
2. The bootstrap script installs `neo4j-graphrag[openai,qdrant]` and required runtime packages (`neo4j`, `qdrant-client`, `openai`, `structlog`, `pytest`) with explicit version pins captured in a committed lock artifact for reproducible reinstalls. [Source: bmad/focused-epics/environment-workspace/epic.md#risk-mitigation] [Source: architecture/tech-stack.md#technology-stack]
3. After installation the script activates the virtual environment, runs `python -c "import neo4j_graphrag"`, and exits non-zero on failure while emitting actionable messaging without exposing secrets. [Source: prd.md#epic-1--environment--workspace] [Source: architecture/coding-standards.md#critical-rules]
4. Script output documents follow-up steps (activating the environment, next story `.env` template) in plain text and leaves no credentials or tokens in the terminal history. [Source: prd.md#epic-1--environment--workspace] [Source: architecture/coding-standards.md#critical-rules]

## Tasks / Subtasks
- [x] Author `scripts/bootstrap.sh` with `set -euo pipefail`, Python 3.12 detection, and `.venv` creation (AC: 1). [Source: architecture/source-tree.md#source-tree-blueprint]
  - [x] Add argument support to override virtual environment path while defaulting to `.venv` (AC: 1). [Source: architecture/source-tree.md#source-tree-blueprint]
- [x] Pin dependency versions by installing `neo4j-graphrag[openai,qdrant]` and exporting freeze output to `requirements.lock` under version control (AC: 2). [Source: bmad/focused-epics/environment-workspace/epic.md#risk-mitigation]
  - [x] Optionally leverage `pip-tools` when available, falling back to `pip install -r` to keep bootstrap deterministic (AC: 2). [Source: architecture/tech-stack.md#technology-stack]
- [x] Implement post-install validation `python -c "import neo4j_graphrag"` with clear error messaging and non-zero exit on failure (AC: 3). [Source: prd.md#epic-1--environment--workspace]
  - [x] Ensure logs omit secrets and identify remediation steps (AC: 3,4). [Source: architecture/coding-standards.md#critical-rules]
- [x] Update project documentation (README or `docs/architecture/overview.md`) with bootstrap usage instructions and next-step pointers to `.env` template work (AC: 4). [Source: architecture/overview.md#architecture-overview]
- [x] Add integration test under `tests/integration/scripts/test_bootstrap.py` exercising script success and failure modes using temporary directories (AC: 1-3). [Source: architecture/coding-standards.md#testing-expectations]

## Dev Notes
### Previous Story Insights
- No prior stories exist for Epic 1; this is the initial workspace deliverable.

### Environment Requirements
- Python 3.12 and CPython runtime are mandatory for all CLI workflows; script must validate interpreter version. [Source: architecture/tech-stack.md#technology-stack]
- Virtual environments should default to `.venv` in repo root to align with reproducible local setups. [Source: architecture/source-tree.md#source-tree-blueprint]

### Dependency Requirements
- Install `neo4j-graphrag` 0.9.x with `openai` and `qdrant` extras plus supporting packages (`neo4j` driver 5.x, `qdrant-client` 1.10+, `openai` 1.x, `structlog` 24.x, `pytest` 8.x). [Source: architecture/tech-stack.md#technology-stack]
- Capture dependency versions in `requirements.lock` to mitigate drift per epic risk mitigation strategy. [Source: bmad/focused-epics/environment-workspace/epic.md#risk-mitigation]

### Project Structure
- Place the script in the `scripts/` directory and ensure it is executable to match repository layout expectations. [Source: architecture/source-tree.md#source-tree-blueprint]

### Coding Standards
- Script messaging must never echo secrets or raw environment variable values. [Source: architecture/coding-standards.md#critical-rules]
- Prefer structured or clearly formatted logging with operation names and statuses for operator clarity. [Source: architecture/coding-standards.md#logging-guidance]
- Limit retry loops and surface installation errors promptly to avoid runaway execution. [Source: architecture/coding-standards.md#critical-rules]

### Technical Constraints
- Support optional `pip-tools` usage when present to align with preferred dependency locking workflows. [Source: architecture/tech-stack.md#technology-stack]
- Ensure compatibility with managed Neo4j and Qdrant services remains unaffected since this story touches only local tooling. [Source: architecture/overview.md#high-level-components]

### Testing
- Use `pytest` for tests; mirror `scripts/` path under `tests/integration/scripts/` and leverage sandbox fixtures when spawning subprocesses. [Source: architecture/coding-standards.md#testing-expectations]
- Avoid external service calls during tests; rely on temporary directories and patching to validate script behavior. [Source: architecture/coding-standards.md#testing-expectations]

## Testing
- Integration test: run bootstrap script inside a temp directory verifying `.venv` creation, dependency install mock, and import check success (covers AC 1-3).
- Failure test: simulate missing Python 3.12 interpreter or forced version mismatch and assert non-zero exit with actionable messaging (covers AC 1).
- Failure test: force import failure (e.g., temporary removal of package) and confirm script surfaces remediation guidance without exposing secrets (covers AC 3-4).

## Change Log
| Date       | Version | Description                        | Author |
|------------|---------|------------------------------------|--------|
| 2025-09-24 | 0.1     | Initial draft of Story 1.1 created | Bob    |

## Dev Agent Record
### Agent Model Used
GPT-5 Codex (CLI)

### Debug Log References
* `pytest tests/integration/scripts/test_bootstrap.py`

### Completion Notes List
* Created `scripts/bootstrap.sh` with interpreter detection (`python3.12`, pyenv/asdf shims), optional `--venv-path`/`--force` flags, skip-install test mode, and guidance messaging that avoids echoing secrets.
* Checked in `requirements.lock` with pinned baseline versions; script regenerates the lockfile (or populates stub content when `BOOTSTRAP_SKIP_INSTALL=1` is set for CI/tests).
* Added integration coverage exercising happy path, incompatible interpreter refusal, custom venv overrides, and idempotent reruns using shimmed interpreters.
* Updated `docs/architecture/overview.md` to surface bootstrap activation steps and reference the follow-on `.env` story for operators.
* Added conditional pip-tools supportâ€”script writes a temporary requirements.in when `pip-compile` is present and falls back to `pip freeze` otherwise.
* Added test-mode flags (`BOOTSTRAP_TEST_IMPORT`) to simulate import validation success/failure without publishing secrets or requiring network installs.

### File List
* scripts/bootstrap.sh
* requirements.lock
* tests/integration/scripts/test_bootstrap.py
* docs/architecture/overview.md
* docs/stories/1.1.workspace-bootstrap-script.md

## QA Results
### Risk Profile
- 2025-09-25: docs/qa/assessments/1.1-risk-20250925.md (risk_summary snippet available for gate)

### Test Design
- 2025-09-25: docs/qa/assessments/1.1-test-design-20250925.md (test_design snippet available for gate)

### Traceability
- 2025-09-25: docs/qa/assessments/1.1-trace-20250925.md (trace snippet available for gate)

### NFR Assessment
- 2025-09-25: docs/qa/assessments/1.1-nfr-20250925.md (nfr_validation snippet available for gate)

### PO Validation
- 2025-09-25: docs/qa/assessments/1.1-po-validation-20250925.md (Approved with follow-ups)
