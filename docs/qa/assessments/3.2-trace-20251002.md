# Requirements Traceability Matrix â€“ Story 3.2

Date: 2025-10-02
Reviewer: Quinn (QA)

## Coverage Summary

- Total Requirements: 4
- Fully Covered: 3 (75%)
- Partially Covered: 1 (25%)
- Not Covered: 0 (0%)

## Requirement Mappings

### AC1: Emit structured QA report with chunk counts, token histograms, orphan/node integrity checks, embedding validation, persisted under artifacts/ingestion/<timestamp>/

**Coverage: FULL**

- **Unit Test**: `tests/unit/scripts/test_kg_build.py::test_run_pipeline_success`
  - Given: an ingestion run over sample text with QA enabled
  - When: `kg_build.py` executes with profile defaults
  - Then: QA report JSON/Markdown artifacts are created with metrics for chunks, tokens, and integrity checks (validated paths recorded)
  - Coverage: unit
- **Integration Intent**: `tests/unit/scripts/test_kg_build.py::test_run_directory_ingestion`
  - Given: directory ingestion containing markdown and code files
  - When: QA-enabled run completes
  - Then: Report directory is generated with timestamped artifacts for mixed corpus ingestion
  - Coverage: unit/integration-style (uses fake driver)

### AC2: Threshold-driven gating aborts on anomalies with non-zero exit and transactional rollback

**Coverage: FULL**

- **Unit Test**: `tests/unit/scripts/test_kg_build.py::test_run_fails_on_qa_threshold`
  - Given: QA thresholds configured to allow no missing embeddings and driver returning missing embeddings
  - When: `kg_build.py` runs
  - Then: QA gate fails, raises RuntimeError, and rollback queries are executed (verified via fake driver queries)
  - Coverage: unit
- **Unit Test**: `tests/unit/scripts/test_kg_build.py::test_run_skips_reset_without_flag`
  - Given: default thresholds with healthy data
  - When: ingestion runs without `--reset-database`
  - Then: No destructive reset occurs, confirming gating only blocks on anomalies
  - Coverage: unit

### AC3: QA telemetry sanitized, documented, and accessible (no secrets; documentation updated)

**Coverage: PARTIAL**

- **Manual Evidence**: Updated docs (`README.md`, `docs/architecture/overview.md`, `docs/architecture/coding-standards.md`) captured workflow guidance and sanitization expectations
  - Given: Need for operators to locate sanitized reports
  - When: Documentation is reviewed
  - Then: QA workflow details are available (no automated test verifying sanitization or doc presence)
  - Coverage: documentation review
- **Unit Test**: `tests/unit/scripts/test_kg_build.py::test_run_pipeline_success`
  - Given: sample run
  - When: report paths resolved
  - Then: QA artifacts exist and are scrubbed via `scrub_object`
  - Coverage: unit (artifact existence)
- **Gap**: No explicit automated assertion ensuring QA Markdown omits secrets/absolute paths beyond default sanitizer behaviour

### AC4: Unit/integration coverage for QA success/failure paths and CI wiring

**Coverage: FULL**

- **Unit Tests**: `tests/unit/scripts/test_kg_build.py` suite (cases: `test_run_pipeline_success`, `test_run_fails_on_qa_threshold`, `test_run_directory_ingestion`)
  - Given: QA-enabled ingestion scenarios
  - When: success and failure paths executed
  - Then: Reports generated, gating enforced, rollback validated
  - Coverage: unit
- **Test Plan**: docs/qa/assessments/3.2-test-design-20251002.md outlines integration/CI follow-ups
  - Coverage: planning artifact

## Coverage Gaps

1. **AC3 sanitization automation**
   - Gap: No explicit unit test asserts redaction of absolute paths within QA markdown beyond happy-path fixture
   - Severity: medium
   - Suggested Test: Add unit coverage ensuring sanitized outputs exclude secrets/absolute paths when fed unsafe input

## Trace Output Summary

- Trace matrix stored at `docs/qa/assessments/3.2-trace-20251002.md`
- Planning reference: `docs/qa/assessments/3.2-test-design-20251002.md`

```
trace:
  totals:
    requirements: 4
    full: 3
    partial: 1
    none: 0
  planning_ref: 'docs/qa/assessments/3.2-test-design-20251002.md'
  uncovered:
    - ac: 'AC3'
      reason: 'No automated assertion verifying QA report redaction of sensitive paths'
  notes: 'docs/qa/assessments/3.2-trace-20251002.md'
```

```
Traceability report: docs/qa/assessments/3.2-trace-20251002.md
```
