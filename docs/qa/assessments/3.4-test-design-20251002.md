# Test Design: Story 3.4 (Documentation Lint Automation)

Date: 2025-10-02
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 7
- Unit tests: 3 (42.9%)
- Integration tests: 3 (42.9%)
- End-to-end tests: 1 (14.2%)
- Priority distribution: P0: 5, P1: 2, P2/P3: 0

## Test Scenarios by Acceptance Criteria

### AC1 – Lint command enforces minimal-path and retriever references

| ID              | Level       | Priority | Test Description                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------------------|---------------|
| 3.4-UNIT-001    | Unit        | P0       | Validate that required minimal-path tokens (e.g., `scripts/check_local_stack.sh`) are detected when removed from fixtures. | Pure parsing logic; guards TECH-001 before integration layers. |
| 3.4-UNIT-002    | Unit        | P0       | Verify detector flags missing `QdrantNeo4jRetriever` references and surfaces specific remediation hints. | Ensures high-risk retriever drift is caught via fast feedback. |
| 3.4-INT-001     | Integration | P0       | Execute `python -m scripts.check_docs` against pristine repo docs; expect exit 0 and structured logs per coding standards. | Validates CLI wiring, structured logging, and `.env` handling. |
| 3.4-INT-002     | Integration | P0       | Run lint against mutated fixture lacking retriever mention; expect exit 1, actionable message, and sanitized JSON artifact. | Confirms failure path aligns with AC1 & AC4 and mitigates TECH-001. |

### AC2 – Automation/CI integration blocks drift

| ID              | Level       | Priority | Test Description                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------------------|---------------|
| 3.4-INT-003     | Integration | P0       | Invoke CI harness (pytest/Make target or GitHub workflow job) to ensure lint runs inside the project virtualenv and fails pipeline on drift. | Validates automation hook and dependency availability (OPS-001). |
| 3.4-E2E-001     | E2E         | P1       | Full CI rehearsal: run minimal-path smoke workflow followed by documentation lint step; confirm combined pipeline exits non-zero when docs are stale. | Ensures end-to-end enforcement in the primary delivery workflow. |

### AC3 – Architecture runbook documents the guard

| ID              | Level       | Priority | Test Description                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------------------|---------------|
| 3.4-UNIT-003    | Unit        | P1       | Assert remediation template embeds doc references (`docs/architecture/overview.md`, `docs/architecture/source-tree.md`) and guidance on updating runbook instructions. | Keeps documentation updates aligned and prevents OPS-002 false alarms. |

### AC4 – Automated tests cover success, failure, remediation messaging

Coverage delivered via scenarios 3.4-UNIT-001/002/003 and 3.4-INT-001/002/003 which validate both pass/fail states and messaging, plus the CI rehearsal (3.4-E2E-001) to ensure regressions surface in realistic flows.

## Risk Coverage

- **TECH-001 (High):** Mitigated by 3.4-UNIT-001, 3.4-UNIT-002, 3.4-INT-001, 3.4-INT-002.
- **OPS-001 (Medium):** Mitigated by 3.4-INT-003 and 3.4-E2E-001.
- **OPS-002 (Medium):** Mitigated by 3.4-UNIT-003 (message hygiene) and monitored via 3.4-INT-002 failure assertions.
- **TECH-002 (Low):** Mitigated by 3.4-INT-003 (config-driven harness) ensuring renamed shards surface quickly.

## Recommended Execution Order

1. 3.4-UNIT-001, 3.4-UNIT-002, 3.4-UNIT-003
2. 3.4-INT-001, 3.4-INT-002, 3.4-INT-003
3. 3.4-E2E-001 (nightly or pre-merge smoke)

---

**Test design matrix:** docs/qa/assessments/3.4-test-design-20251002.md
**P0 tests identified:** 5
