# NFR Assessment: 1.3

Date: 2025-10-09
Reviewer: Quinn (Test Architect)

## Summary

- Security: CONCERNS — Docker image build lacks automated secret scanning/digest capture; smoke Compose hardcodes a static token with no guardrails.
- Performance: CONCERNS — No latency measurements inside the containerized stack; smoke test only asserts functional success.
- Reliability: PASS — Health checks, Bolt wait helper, and end-to-end smoke verification provide confidence in startup sequencing.
- Maintainability: CONCERNS — Dual Compose definitions (`docker-compose.yml` vs `docker-compose.smoke.yml`) must stay in sync manually; no shared fragments or validation.

## Critical Issues

1. **Secret hygiene automation missing** (Security)
   - Risk: Secrets or tokens could be baked into layers without CI blockers, reintroducing SEC-002.
   - Fix: Add CI stage running `trivy --scanners secret` (or gitleaks) against the built image and fail on findings; capture image digest in logs.

2. **Latency target unverified** (Performance)
   - Risk: Containerized FastMCP could exceed the ≤1.5 s hybrid search budget without detection.
   - Fix: Instrument `tests/smoke/test_stack.py` (or follow-on perf test) to time `/mcp/search` and assert on the configured threshold.

3. **Compose drift risk** (Maintainability)
   - Risk: Production and smoke manifests may diverge (ports, env vars) causing inconsistent behavior.
   - Fix: Derive the smoke Compose via override/extends or add validation that both declare identical `mcp` settings.

## Quick Wins

- Add `.github/workflows/docker-scan.yml` executing `docker compose build mcp` + `trivy --scanners secret` to automate build hygiene.
- Capture `/mcp/search` latency in the smoke test (simple `time.monotonic()` before/after) and fail when above the documented budget.
- Create a unit test (or script) that loads both Compose files and compares critical keys (image, networks, healthcheck) to detect drift.

NFR assessment: docs/qa/assessments/1.3-nfr-20251009.md

Gate NFR block ready → paste into docs/qa/gates/1.3-containerized-deployment.yml under nfr_validation
