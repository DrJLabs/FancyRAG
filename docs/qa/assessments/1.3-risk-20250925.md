# Risk Profile: Story 1.3

Date: 2025-09-25
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 4
- Critical Risks: 0
- High Risks: 2
- Risk Score: 82/100

Workspace verification touches critical observability and reproducibility surfaces. Improper module coverage, secret exposure, or artifact drift can undermine bootstrap reliability and governance. Sources: docs/stories/1.3.environment-validation-command.md, docs/architecture/coding-standards.md, docs/architecture/tech-stack.md, docs/prd.md#epic-1--environment--workspace, docs/stories/1.2.environment-configuration-template.md.

## Risk Distribution
### By Category
- Technical: 2 risks (High: 1)
- Security: 1 risk (High: 1)
- Operational: 1 risk (High: 0)

### By Component
- CLI diagnostics command: 2 risks
- Reporting pipeline (`artifacts/environment/versions.json`): 1 risk
- Documentation / bootstrap handoff: 1 risk

## Risk Matrix
| Risk ID  | Description                                                                                       | Probability | Impact | Score | Priority |
|----------|---------------------------------------------------------------------------------------------------|-------------|--------|-------|----------|
| TECH-301 | Import coverage misses required distributions or swallows `PackageNotFoundError`, giving false pass | Medium (2)  | High (3) | 6 | High |
| SEC-301  | Diagnostic logs or JSON report emit secrets/API keys from environment variables                    | Medium (2)  | High (3) | 6 | High |
| OPS-301  | `versions.json` path not gitignored or directory missing, causing CI noise or write failures       | Medium (2)  | Medium (2) | 4 | Medium |
| TECH-302 | Hash provenance mismatches due to stale `requirements.lock` or non-deterministic git metadata      | Low (1)     | Medium (2) | 2 | Low |

## Detailed Risk Register
| Risk ID  | Category   | Description | Probability | Impact | Score | Mitigation | Residual Risk |
|----------|------------|-------------|-------------|--------|-------|------------|----------------|
| TECH-301 | Technical  | Module discovery list does not map extras (`qdrant-client`, `neo4j_graphrag`), so verification passes despite missing installs. | Medium (2) | High (3) | 6 | Maintain explicit moduleâ†’distribution mapping; raise on `PackageNotFoundError` with actionable remediation; cover via unit tests mocking missing packages. | Upstream package renames may bypass mapping until updated. |
| SEC-301  | Security   | Logging/report serialization captures environment values or tokens (e.g., `OPENAI_API_KEY`). | Medium (2) | High (3) | 6 | Central redaction utility masking patterns before logging; store report without secrets; add regression tests to assert redaction. | Operators may run command with verbose flag reintroducing sensitive fields. |
| OPS-301 | Operational | Diagnostics command fails to create artifacts directory or repo accidentally commits `artifacts/environment/versions.json`. | Medium (2) | Medium (2) | 4 | Ensure bootstrap and CLI create directories atomically; add `.gitignore` entry and CI check to prevent tracked artifacts. | Manual overrides may still commit artifacts. |
| TECH-302 | Technical  | Hash comparison drifts when `requirements.lock` absent or regenerated outside deterministic tooling. | Low (1) | Medium (2) | 2 | Detect missing lockfile and surface warning; document recomputation flow; add tests snapshotting expected schema and hash length. | Lockfile intentionally rotated without updating docs/tests. |

## Risk-Based Testing Strategy
- **Priority 1:** Unit tests simulating `PackageNotFoundError` to guarantee diagnostics exits non-zero with clear remediation (TECH-301).
- **Priority 1:** Unit tests verifying log/report redaction scrub secret-shaped strings (SEC-301).
- **Priority 2:** Integration test confirming artifacts directory creation and `.gitignore` compliance to avoid committing reports (OPS-301).
- **Priority 2:** Integration test hashing `requirements.lock` and asserting deterministic SHA-256 output with snapshot (TECH-302).

## Risk Acceptance Criteria
- Must fix before release: TECH-301, SEC-301.
- Deploy with monitoring: OPS-301, TECH-302.
- Accepted: None.

## Monitoring Requirements
- Add CI guard that runs diagnostics with controlled env to confirm failures bubble up and secrets remain masked.
- Observe generated artifacts footprint; alert when report missing or schema changes.

## Gate Snippet
```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 1
    low: 1
  highest: TECH-301
  recommendations:
    must_fix:
      - Enforce explicit module mapping and fail fast on missing dependencies.
      - Add redaction regression tests covering diagnostics logs.
    monitor:
      - Verify artifacts/environment is gitignored and created on demand.
```

## Hook Line
Risk profile: docs/qa/assessments/1.3-risk-20250925.md
