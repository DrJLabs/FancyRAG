# Requirements Traceability Matrix

## Story: 2.4 – Docker Compose Stack for Neo4j + Qdrant

### Coverage Summary
- Total Requirements (Acceptance Criteria): 4
- Fully Covered: 4 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Requirement Mappings

#### AC1: Compose file provisions Neo4j 5.26 + APOC Core and Qdrant ≥1.8 with `.env`-driven credentials and persistent volumes.
- Coverage: FULL
- Verification artefacts:
  - `tests/unit/compose/test_compose_file.py::test_compose_defines_expected_images_and_ports` – asserts image tags and exposed ports.
  - `tests/unit/compose/test_compose_file.py::test_compose_env_variables_present` – confirms credential wiring and bind-mount paths.
  - CI lint step `scripts/check_local_stack.sh --config` exercises docker compose rendering.

#### AC2: Compose services expose health checks/restart policies aligned with minimal path scripts.
- Coverage: FULL
- Verification artefacts:
  - `tests/unit/compose/test_compose_file.py::test_compose_healthchecks_defined` and `::test_compose_restart_policy` validate health check commands + restart settings.
  - `tests/integration/local_stack/test_check_local_stack.py::test_check_local_stack_status_wait_reports_when_stack_missing` verifies the helper surfaces health failures with actionable messaging.

#### AC3: Documentation updated with runbooks, `.env` guidance, and CI compatibility notes.
- Coverage: FULL
- Verification artefacts:
  - `docs/architecture/overview.md` (Environment Configuration, Minimal Path Workflow, Local Stack Automation) updated 2025-09-29.
  - `.env.example` defaults reflect compose stack values and advertised address overrides.

#### AC4: Automated verification via compose lint + minimal-path smoke workflow ensuring logs redacted and exit codes propagate.
- Coverage: FULL
- Verification artefacts:
  - `scripts/check_local_stack.sh` CLI + `.github/workflows/local-stack-smoke.yml` run `docker compose config` and smoke pytest job.
  - `tests/integration/local_stack/test_minimal_path_smoke.py` starts stack, waits for health, executes stub scripts, and tears down volumes (skips only when Docker CLI unavailable).
  - Stub scripts (`scripts/create_vector_index.py`, `kg_build.py`, `export_to_qdrant.py`, `ask_qdrant.py`) validate environment wiring and emit redacted logs for automation.

### Notes
- Production-parity checklist recorded at `docs/qa/assessments/2.4-production-parity-checklist.md` to monitor follow-up items (digest pinning, advanced APOC config, CI secrets guidance).
- Once Story 2.5 replaces stub scripts with full ingestion pipeline, update smoke assertions to validate grounded answers vs. placeholder output.

---
Trace matrix: docs/qa/assessments/2.4-trace-20250929.md
