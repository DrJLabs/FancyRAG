# Test Design: Story 4.4 (QA Evaluator Module)

Date: 2025-10-04
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 8
- Unit tests: 5 (62.5%)
- Integration tests: 2 (25.0%)
- End-to-End tests: 1 (12.5%)
- Priority distribution: P0: 4, P1: 3, P2: 1, P3: 0

## Test Scenarios by Acceptance Criteria

### AC1 – Implement dedicated evaluator module with existing API

| ID             | Level | Priority | Test | Justification |
|----------------|-------|----------|------|---------------|
| 4.4-UNIT-001   | Unit  | P0       | Validate evaluator pass path metrics and report artefacts | Pure evaluator logic validating success cases without external dependencies |
| 4.4-UNIT-002   | Unit  | P0       | Ensure threshold breaches produce anomalies and failure status | Guards regression where extraction could skip rollback trigger conditions |
| 4.4-UNIT-003   | Unit  | P1       | Cover semantic summary enrichment counts within evaluator | Semantic aggregation remains local logic; unit scope keeps feedback tight |

### AC2 – Preserve versioned JSON/Markdown reports and threshold overrides

| ID             | Level | Priority | Test | Justification |
|----------------|-------|----------|------|---------------|
| 4.4-UNIT-004   | Unit  | P1       | Verify evaluator writes versioned report files via shared path helpers | Report serialisation remains pure function; unit provides fast regression safety |

### AC3 – Pipeline consumes evaluator without behaviour drift

| ID             | Level       | Priority | Test | Justification |
|----------------|-------------|----------|------|---------------|
| 4.4-INT-001    | Integration | P0       | Exercise pipeline success path to confirm QA section structure and metrics pass-through | Requires orchestrating pipeline components; integration scope proves wiring |
| 4.4-INT-002    | Integration | P0       | Simulate evaluator failure to confirm pipeline rollback and error propagation | Pipeline+evaluator interaction; integration verifies rollback invocation |

### AC4 – Refresh unit/integration suites for evaluator coverage

| ID             | Level | Priority | Test | Justification |
|----------------|-------|----------|------|---------------|
| 4.4-UNIT-005   | Unit  | P1       | Extend evaluator tests covering semantic data and histogram bins | Maintains fine-grained coverage expected by refactor plan |

### AC5 – Update architecture documentation shards

| ID             | Level | Priority | Test | Justification |
|----------------|-------|----------|------|---------------|
| 4.4-E2E-001    | E2E   | P2       | Run `scripts.check_docs` via smoke to confirm documentation shards remain accurate | Documentation validation is end-to-end because it exercises tooling and generated artefacts |

## Risk Coverage
- TECH-001 mitigated by 4.4-UNIT-001, 4.4-UNIT-002, 4.4-INT-001, 4.4-INT-002.
- DATA-001 mitigated by 4.4-UNIT-004, 4.4-UNIT-005, 4.4-E2E-001.
- OPS-001 mitigated by 4.4-E2E-001 (ensures `.env` auto-load smoke remains part of workflow).

## Recommended Execution Order
1. 4.4-UNIT-001 (P0)
2. 4.4-UNIT-002 (P0)
3. 4.4-INT-001 (P0)
4. 4.4-INT-002 (P0)
5. 4.4-UNIT-003 (P1)
6. 4.4-UNIT-004 (P1)
7. 4.4-UNIT-005 (P1)
8. 4.4-E2E-001 (P2)

## Test Design YAML (for gate file)
```yaml
test_design:
  scenarios_total: 8
  by_level:
    unit: 5
    integration: 2
    e2e: 1
  by_priority:
    p0: 4
    p1: 3
    p2: 1
    p3: 0
  coverage_gaps: []
```

## Trace References
Test design matrix: docs/qa/assessments/4.4-test-design-20251004.md
P0 tests identified: 4
