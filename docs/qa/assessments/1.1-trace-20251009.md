# Traceability Matrix — Story 1.1 Scripted Index Automation (2025-10-09)

## Overview
- **Story ID**: 1.1 (Scripted Index Automation)
- **Epic**: Hybrid Retrieval Foundation
- **Status at Review**: Ready for Review
- **Scope Summary**: Deliver an idempotent Neo4j full-text index script, expose a Makefile automation target, document operational workflows, and extend configuration samples to support hybrid retrieval bootstrap.
- **Sources Consulted**: `docs/stories/1.1.scripted-index-automation.md`, `scripts/create_fulltext_index.py`, `Makefile`, `.env.example`, `README.md`, `tests/scripts/test_create_fulltext_index.py`.

## Acceptance Criteria Trace Matrix

| Requirement / Acceptance Criteria | Implementation Artifacts | Verification Artifacts | Status & Notes |
| --- | --- | --- | --- |
| **AC1** Script creates `chunk_text_fulltext` via GraphRAG helper and reruns without error. | `scripts/create_fulltext_index.py` implements `ensure_fulltext_index` using `neo4j_graphrag.indexes.create_fulltext_index` with JSON logging and idempotent guard. README documents rerun behaviour. | `tests/scripts/test_create_fulltext_index.py::test_ensure_fulltext_index_is_idempotent` exercises create + rerun path; `::test_load_config_missing_variables_raises_configuration_error`, `::test_load_config_applies_defaults`, and readiness tests validate config safety. | ✅ Unit + readiness coverage confirm idempotency; CI smoke double-runs Makefile target for live assurance. |
| **AC2** Makefile exposes `fulltext-index` target documented alongside `index`. | `Makefile` adds `fulltext-index` target depending on `up` and invoking `uv run python scripts/create_fulltext_index.py`; README quick start lists the new target and usage guidance. | `.github/workflows/fulltext-index-smoke.yml` provisions Neo4j via compose and calls `make fulltext-index` twice per run; README and `.env.example` updated with readiness tuning knobs. | ✅ CI smoke now exercises automation end-to-end, covering README + Makefile alignment. |
| **AC3** `.env.example` lists index variables with sensible defaults. | `.env.example` adds `INDEX_NAME`, `FULLTEXT_INDEX_NAME`, `FULLTEXT_LABEL`, `FULLTEXT_PROPERTY` entries with defaults; README reiterates values for operators. | `tests/scripts/test_create_fulltext_index.py::test_env_example_contains_new_index_variables` asserts presence of required lines. | ✅ Static check covers defaults; consider expanding test to assert accompanying README instructions if doc drift becomes an issue. |

## Task Traceability

- Script authoring & logging tasks map to `scripts/create_fulltext_index.py` plus unit coverage noted above.
- Makefile automation task fulfilled by `Makefile` target; CI smoke now verifies automation via compose.
- `.env.example` updates trace to static test `test_env_example_contains_new_index_variables`.
- Documentation task satisfied via `README.md` updates describing automation and rerun guidance.
- Testing task progressed with unit suite; integration/E2E items remain planned per `docs/qa/assessments/1.1-test-design-20251009.md`.

## Coverage Summary
- **Automated**: 6 unit tests executed via `uv run pytest` covering idempotent creation, configuration validation, readiness waits, and `.env.example` contract. GitHub Actions smoke workflow provisions Neo4j and runs `make fulltext-index` twice.
- **Manual/Planned**: Operator walkthrough (scenario 1.1-E2E-001) remains optional for handbook validation; documentation lint under consideration (scenario 1.1-PRO-001).
- **Residual Gaps**: README drift risk reduced via CI smoke; consider lightweight doc lint only if future stories expand operator docs (scenario 1.1-PRO-001).

---
Trace matrix stored at `docs/qa/assessments/1.1-trace-20251009.md`.
