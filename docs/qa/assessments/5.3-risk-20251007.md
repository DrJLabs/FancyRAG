# Risk Assessment: Story 5.3 (Automate Stack Lifecycle Workflows)

Date: 2025-10-07
Assessor: Quinn (Test Architect)

## Risk Summary

| ID        | Type        | Description                                                                                                                      | Likelihood | Impact | Score | Status            | Mitigation |
| --------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------- | ---------- | ------ | ----- | ----------------- | ---------- |
| TECH-201  | Technical   | New `make service-run` orchestration might bypass typed settings or helper sequencing, causing ingestion/export/evaluation drift.| Low (1)    | Medium (2) | 2   | Mitigated          | Guard rails covered by `tests/unit/fancyrag/cli/test_service_workflow.py::test_service_run_invokes_stages_in_order` and friends; rollback test closes remaining path drift. |
| DATA-122  | Data        | Rollback/reset targets could leave Neo4j/Qdrant volumes dirty or lose QA artefacts when runs fail mid-flight.                     | Low (1)    | High (3) | 3   | Mitigated          | `tests/unit/fancyrag/cli/test_service_workflow.py::test_service_rollback_invokes_cleanup` verifies ingest rollback, Qdrant deletion, and teardown flags; integration smoke still executes `make service-reset`. |
| OPS-185   | Operational | Automation may execute without verifying Docker health or prerequisites, producing confusing operator failures.                  | Medium (2) | Medium (2) | 4 | Planned Mitigation | Chain `scripts/check_local_stack.sh --status --wait` and emit structured health logs; document prerequisites in onboarding updates. [Source: docs/architecture/overview.md#built-in-tool-playbook] [Source: docs/brownfield-architecture.md#runtime-components] |
| SEC-097   | Security    | Make targets could echo sensitive environment variables or `.env` contents into logs/artifacts.                                 | Low (1)    | Low (1) | 1 | Mitigated          | Stage failures sanitize summary/log output (`src/fancyrag/cli/service_workflow.py:142-153,468-475`), and regression test `tests/unit/fancyrag/cli/test_service_workflow.py::test_stage_failure_sanitizes_summary` guards against leaks. |

Overall residual score: 32 (Low-to-moderate risk) with OPS-185 remaining the primary watch item.

## Open Risks & Follow-ups

- Monitor OPS-185 by capturing health check telemetry each time CI triggers the automation workflow; other risks closed by regression coverage.

## Mitigation Plan

1. Keep automation regression suite (unit rollback + integration smoke) green in CI; expand to additional presets as they land.
2. Extend onboarding docs with prerequisite checks and masking guidance to keep operator steps reproducible and safe.

## Residual Risk Evaluation

- Critical/High risks remain open until integration smoke and rollback validation pass in CI.
- Reassess after first green automation run; expected residual score should drop below 60 once mitigations land.
