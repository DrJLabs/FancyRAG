# Test Design: Story 3.1 – Adaptive Chunking Profiles & Source-Aware Ingestion

Date: 2025-10-01
Designer: Quinn (QA)

## Test Strategy Overview
- Total test scenarios: 7
- Unit tests: 3 (43%)
- Integration tests: 3 (43%)
- E2E tests: 1 (14%)
- Priority distribution: P0: 2, P1: 3, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1 – Chunking Presets
| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 3.1-UNIT-001 | unit | P0 | Validate profile -> splitter mapping (text, markdown, code) returns expected component types and parameters. | Pure mapping logic without external IO. |
| 3.1-INT-001 | integration | P1 | Run `kg_build.py` with each profile against fixture corpus to ensure chunk counts and overlap match expectations. | Requires Neo4j mocking and pipeline wiring. |

### AC2 – Directory Ingestion & Metadata
| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 3.1-UNIT-002 | unit | P1 | Hash/sanitisation helper returns SHA-256 for mixed inputs and skips binary with warning flag. | Isolated function behaviour. |
| 3.1-INT-002 | integration | P0 | Simulate directory with nested markdown/code/binary files; assert deterministic ordering, metadata fields (path, SHA, commit) present in Neo4j driver writes. | Validates multi-component flow. |
| 3.1-INT-003 | integration | P1 | Execute minimal path with directory source and verify export script payloads include new metadata keys while size remains under threshold. | Ensures downstream compatibility. |

### AC3 – Backward Compatibility & Qdrant Payloads
| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 3.1-E2E-001 | e2e | P0 | Full minimal path run using default profile and sample corpus, confirming retrieval success and log stability. | End-to-end regression guard. |

### AC4 – Test Coverage for Profiles
| ID | Level | Priority | Test | Justification |
| --- | --- | --- | --- | --- |
| 3.1-UNIT-003 | unit | P2 | Directory walker normalises relative paths across POSIX/Windows separators. | Small pure logic case. |
| 3.1-INT-004 | integration | P2 | Compose smoke extended fixture verifying metadata parity before export, saving QA artifacts. | Combined pipeline behaviour.

## Risk Coverage Mapping
- TECH-001 mitigated by scenarios 3.1-INT-002, 3.1-INT-003, 3.1-INT-004, 3.1-E2E-001.
- PERF-001 mitigated by 3.1-INT-001 (performance assertions) and monitoring plans.
- OPS-001 mitigated by 3.1-UNIT-002 and 3.1-INT-002.
- TECH-002 mitigated by 3.1-UNIT-003 and 3.1-INT-002.
- BUS-001 mitigated via documentation update tasks (non-test).

## Recommended Execution Order
1. P0 unit/integration tests (3.1-UNIT-001, 3.1-INT-002, 3.1-INT-003).
2. E2E regression (3.1-E2E-001).
3. Remaining P1 tests (3.1-INT-001, 3.1-UNIT-002).
4. P2 maintenance coverage (3.1-UNIT-003, 3.1-INT-004).

```yaml
test_design:
  scenarios_total: 7
  by_level:
    unit: 3
    integration: 3
    e2e: 1
  by_priority:
    p0: 2
    p1: 3
    p2: 2
  coverage_gaps: []
```

Test design matrix: docs/qa/assessments/3.1-test-design-20251001.md
P0 tests identified: 2
