# Risk Profile – Story 3.5 (Semantic Enrichment Pipeline & Retrieval Surfacing)

Date: 2025-10-02
Analyst: Quinn (QA)

## Summary
- Overall residual risk score: 73/100 (moderate).
- Critical risks: 0.
- High risks: 1 (extractor integration fallout).
- Medium risks: 3 (semantic QA thresholds, metadata propagation, runtime/cost pressure).
- Low risks: 1 (documentation guard drift).

## Risk Matrix

| Risk ID | Category | Description | Probability | Impact | Score | Priority |
| --- | --- | --- | --- | --- | --- | --- |
| TECH-201 | Technical | `LLMEntityRelationExtractor` errors or schema drift prevent ingestion from completing, leaving Neo4j/Qdrant in a partial state despite rollback guarantees. | Medium (2) | High (3) | 6 | High |
| DATA-202 | Data | Entity/relationship nodes lose required metadata (relative path, checksum, git commit) so retrieval joins and QA telemetry mis-report context. | Medium (2) | Medium (2) | 4 | Medium |
| OPS-203 | Operational | New semantic QA thresholds trigger false failures, blocking ingestion/CI pipelines for benign variance in extractor output. | Medium (2) | Medium (2) | 4 | Medium |
| PERF-204 | Performance | Semantic enrichment adds OpenAI calls that spike runtime/cost, causing rate-limit retries or exceeding compose smoke time budgets. | Medium (2) | Medium (2) | 4 | Medium |
| OPS-205 | Operational | Documentation lint guard or operator runbooks lag semantic workflow updates, leading to run/playbook mismatch. | Low (1) | Medium (2) | 2 | Low |

## Mitigation Strategies
- **TECH-201:** Add unit tests stubbing extractor output and asserting rollback/threshold sequencing; ensure pipeline keeps enrichment behind a feature flag with default-off capability; expand integration smoke to cover extractor-enabled run with validation that rollback leaves clean state.
- **DATA-202:** Extend serializer tests to assert metadata propagation into Neo4j nodes and Qdrant payloads; capture fixtures for enriched context and validate in retrieval CLI tests; update QA artefacts to surface metadata gaps before export.
- **OPS-203:** Parameterize thresholds via config with sensible defaults and document tuning; add regression suite generating synthetic extractor noise to confirm guard tolerances; surface actionable remediation in gating failures.
- **PERF-204:** Introduce dry-run/token-estimation mode and runtime budget telemetry; enforce batch sizing and concurrency limits via settings; monitor compose smoke duration delta pre/post enrichment.
- **OPS-205:** Update architecture overview/source-tree shards alongside code; enhance documentation lint guard to require semantic workflow references; add release checklist item for semantic doc updates.

## Risk-Based Testing Focus
1. **Priority 1 – TECH-201:** Unit tests around enrichment toggle, error handling, and rollback; integration smoke with semantic mode enabled validating no residual graph artifacts after forced extractor failure.
2. **Priority 2 – DATA-202 & OPS-203:** Unit/integration tests verifying metadata propagation, QA report contents, and threshold tuning (success + fail fixtures); CLI regression ensuring retrieval outputs optional semantic sections without breaking existing schema.
3. **Priority 3 – PERF-204 & OPS-205:** Performance guardrails via integration test capturing runtime metrics; docs lint automation run with new semantic instructions to prevent drift.

## Monitoring Recommendations
- Track ingestion duration, OpenAI token usage, and retry counts in telemetry dashboards to catch PERF-204 regressions.
- Alert when QA gating failure rate exceeds baseline post-enrichment rollout (OPS-203).
- Monitor documentation lint guard results for missing semantic workflow references (OPS-205).

Risk profile: docs/qa/assessments/3.5-risk-20251002.md
