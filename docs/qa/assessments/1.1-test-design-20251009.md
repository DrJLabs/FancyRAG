# Test Design: Story 1.1 — Scripted Index Automation

Date: 2025-10-09
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 6
- By level: Unit 3 (50%), Integration 2 (33%), E2E 1 (17%)
- Priority distribution: P0 2, P1 2, P2 2, P3 0
- Risk alignment: Covers TECH-001, DATA-001, OPS-001, SEC-001, PERF-001 from 2025-10-09 risk assessment.

## Test Scenarios by Acceptance Criteria

### AC1: Script creates `chunk_text_fulltext` via GraphRAG helper and reruns without error


| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 1.1-UNIT-001 | Unit | P0 | Exercise `create_fulltext_index` helper twice with patched Neo4j driver to confirm idempotent branch logging `skip`. | Core logic can be isolated with mocks; fails fast on idempotency bug. | TECH-001 |
| 1.1-UNIT-002 | Unit | P1 | Validate environment variable guard rails (`NEO4J_URI`, `NEO4J_USERNAME`, `NEO4J_PASSWORD`, `NEO4J_DATABASE`) reject missing/blank inputs without leaking secrets. | Pure validation logic; protects against misconfiguration and secret leakage. | SEC-001 |
| 1.1-INT-001 | Integration | P0 | Run script against ephemeral Neo4j (Testcontainers or docker compose) twice, asserting index metadata matches `Chunk`/`text`. | Confirms real driver interaction and schema alignment. | TECH-001, DATA-001 |


### AC2: Makefile exposes `fulltext-index` target documented alongside `index`

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 1.1-INT-002 | Integration | P1 | Invoke `make fulltext-index` in CI-ready container after `docker compose up neo4j`, verifying dependency chain and success logs. | Validates orchestration via Makefile to Docker boundary. | OPS-001 |
| 1.1-E2E-001 | E2E | P2 | Operator smoke: follow README instructions end-to-end (compose bootstrap → `make fulltext-index` → confirm hybrid query). | Ensures documentation + automation align for real operators. | OPS-001, PERF-001 |


### AC3: `.env.example` lists index-related variables with sensible defaults

| ID | Level | Priority | Test | Justification | Mitigates |
|----|-------|----------|------|---------------|-----------|
| 1.1-UNIT-003 | Unit | P2 | Parse `.env.example` to ensure `INDEX_NAME`, `FULLTEXT_INDEX_NAME`, label, property entries exist with documented defaults. | Static file verification fits unit level; prevents configuration drift. | DATA-001 |
| 1.1-PRO-001 | Process | P2 | Documentation review checklist to ensure README includes rerun guidance and log expectations. | Manual/peer review ensures ops notes captured; no automation path. | PERF-001 |

## Risk Coverage
- **TECH-001**: 1.1-UNIT-001, 1.1-INT-001
- **DATA-001**: 1.1-INT-001, 1.1-UNIT-003
- **OPS-001**: 1.1-INT-002, 1.1-E2E-001
- **SEC-001**: 1.1-UNIT-002
- **PERF-001**: 1.1-E2E-001, 1.1-PRO-001

No uncovered risks remain.

## Recommended Execution Order
1. 1.1-UNIT-001 (P0) — idempotent rerun guard
2. 1.1-INT-001 (P0) — real Neo4j double-run
3. 1.1-UNIT-002 (P1) — env validation + redaction
4. 1.1-INT-002 (P1) — Makefile orchestration
5. 1.1-UNIT-003 (P2) — `.env.example` verification
6. 1.1-E2E-001 (P2) — operator smoke walkthrough
7. 1.1-PRO-001 (P2) — documentation checklist

## Gate YAML Block
```yaml
test_design:
  scenarios_total: 6
  by_level:
    unit: 3
    integration: 2
    e2e: 1
  by_priority:
    p0: 2
    p1: 2
    p2: 2
    p3: 0
  coverage_gaps: []
```

---
Test design matrix: docs/qa/assessments/1.1-test-design-20251009.md
P0 tests identified: 2
