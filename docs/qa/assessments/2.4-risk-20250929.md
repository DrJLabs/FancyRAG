# Risk Profile: Story 2.4

Date: 2025-09-29
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 5
- Critical Risks: 0
- High Risks: 0
- Risk Score: 45/100

Automated compose linting, health-check polling, and smoke workflow reduce earlier uncertainty. Residual risks focus on parity drift and future ingestion enhancements. Sources: docs/stories/2.4.docker-compose-neo4j-qdrant.md, docs/bmad/focused-epics/local-stack/epic.md#story-manager-handoff, docs/architecture/overview.md#minimal-path-workflow, docs/qa/assessments/2.4-production-parity-checklist.md.

## Risk Distribution
### By Category
- Technical: 2 risks (Medium: 2)
- Operational: 2 risks (Medium: 2)
- Security: 1 risk (Low: 1)

### By Component
- `docker-compose.neo4j-qdrant.yml`: 2 risks
- Automation helpers / CI workflow: 2 risks
- Production parity controls: 1 risk

## Risk Matrix

| Risk ID  | Description                                                                                           | Probability | Impact | Score | Priority |
|----------|-------------------------------------------------------------------------------------------------------|-------------|--------|-------|----------|
| TECH-240 | Compose stack drifts from expected APOC/credential configuration, breaking ingestion scripts.         | Low (1)     | High (3) | 3 | Medium |
| TECH-241 | Persistent volumes misconfigured, causing data loss or incorrect reuse between runs.                  | Medium (2)  | Medium (2) | 4 | Medium |
| OPS-240  | Automation fails to gate on health status, leading to flaky pipelines.                                | Low (1)     | Medium (2) | 2 | Low |
| OPS-241  | Documentation diverges from automation workflow, confusing operators.                                 | Medium (2) | Medium (2) | 4 | Medium |
| SEC-240  | Compose or scripts log raw credentials sourced from `.env`.                                           | Low (1)     | High (3) | 3 | Medium |

## Detailed Risk Register

| Risk ID  | Category    | Description | Probability | Impact | Score | Mitigation | Residual Risk |
|----------|-------------|-------------|-------------|--------|-------|------------|----------------|
| TECH-240 | Technical   | Drift in APOC/credential settings prevents scripts from connecting. | Low (1) | High (3) | 3 | Unit tests validate compose config; CI lint + smoke run catch regressions; production parity checklist tracks updates. | Monitor upstream image changes each quarter. |
| TECH-241 | Technical   | Volume paths fail to persist or leak stale state between runs. | Medium (2) | Medium (2) | 4 | Bind mounts under `./.data`, helper teardown with `--destroy-volumes`, smoke test exercises start/stop flow. | Parallel developer stacks may still conflict; consider parametrised project names. |
| OPS-240  | Operational | Automation runs before services healthy. | Low (1) | Medium (2) | 2 | Helper script waits for health; integration test verifies failure messaging; CI workflow runs helper before scripts. | Slow runners may require tuning sleep/backoff intervals. |
| OPS-241  | Operational | Documentation drifts from actual workflow. | Medium (2) | Medium (2) | 4 | Architecture overview updated, parity checklist maintained, story tasks captured. | Future ingestion changes need coordinated doc updates. |
| SEC-240  | Security    | Logging leaks credentials. | Low (1) | High (3) | 3 | Scripts only log redacted JSON; smoke assertions planned post-Story 2.5. | Add automated log scrubber once full pipeline lands. |

## Risk-Based Testing Strategy
- Compose config unit tests plus CI lint guard (TECH-240).
- Smoke workflow (start → scripts → teardown) exercises persistence + teardown path (TECH-241).
- Helper status integration test ensures health gating (OPS-240).
- Documentation lint manual review via parity checklist (OPS-241).
- Future secret scrub assertions to be added post-Story 2.5 (SEC-240).

## Risk Acceptance Criteria
- No must-fix items remain; monitor parity checklist and log scrubber enhancements alongside Story 2.5.

## Monitoring Requirements
- Review compose image tags quarterly.
- Review parity checklist items at release planning checkpoints.
- Add log-scrub assertions once ingestion pipeline ships.

## Gate Snippet
```yaml
risk_summary:
  totals:
    critical: 0
    high: 0
    medium: 4
    low: 1
  highest: TECH-241
  recommendations:
    must_fix: []
    monitor:
      - Track parity checklist items during Story 2.5 follow-up.
      - Add log scrubber assertions post-ingestion pipeline delivery.
```

## Hook Line
Risk profile: docs/qa/assessments/2.4-risk-20250929.md
